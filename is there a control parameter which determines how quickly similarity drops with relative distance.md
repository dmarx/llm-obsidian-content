---
date: '2024-12-06T23:54:38.768239Z'
tags:
- autogenerated
- source__claude
- conversation_id__de95873d-a2c7-4ce0-ac45-2f8d31d8cf2d
- msg_7b930d47-dfa2-44cb-b4d0-f423679b7bca
- msg_da805dfe-b461-422f-b90b-ee3afd19fa61
- colorclass/vector-space
title: is there a control parameter which determines how quickly similarity drops
  with relative distance
---

**USER**

is there a control parameter which determines how quickly similarity drops with relative distance?


**ASSISTANT**

Yes! In the original RoPE formulation, this is controlled by the base used in the frequency scaling. Let me modify the visualization to demonstrate this.

<antThinking>This is an update to the previous visualization to show how the base parameter affects similarity decay. The visualization remains complex enough to warrant an artifact.</antThinking>

<antArtifact identifier="rope-heatmap" type="application/vnd.ant.react" title="RoPE Embeddings Distance Visualization with Base Control">
import React, { useState } from 'react';
import { Card, CardHeader, CardTitle, CardContent } from '@/components/ui/card';

const RoPEVisualization = () => {
  const [seqLength, setSeqLength] = useState(16);
  const [base, setBase] = useState(10000);
  
  // Generate RoPE position encodings with configurable base
  const generateRoPEMatrix = () => {
    const matrix = Array(seqLength).fill(0).map(() => Array(seqLength).fill(0));
    
    for (let i = 0; i < seqLength; i++) {
      for (let j = 0; j < seqLength; j++) {
        const relativePos = Math.abs(i - j);
        // Modified decay rate based on the base parameter
        const decay = Math.log(base) / 10;
        matrix[i][j] = Math.exp(-relativePos / decay);
      }
    }
    return matrix;
  };

  const matrix = generateRoPEMatrix();
  
  const getColor = (value) => {
    const h = (1 - value) * 240;
    return `hsl(${h}, 100%, ${50 + value * 30}%)`;
  };

  return (
    <Card className="w-full max-w-2xl">
      <CardHeader>
        <CardTitle>RoPE Position Encoding Similarity Matrix</CardTitle>
      </CardHeader>
      <CardContent>
        <div className="space-y-4">
          <div className="grid grid-cols-1 gap-4">
            <div className="flex space-x-4 items-center">
              <label>Sequence Length:</label>
              <input 
                type="range" 
                min="4" 
                max="32" 
                value={seqLength} 
                onChange={(e) => setSeqLength(parseInt(e.target.value))}
                className="w-48"
              />
              <span>{seqLength}</span>
            </div>
            <div className="flex space-x-4 items-center">
              <label>Base (decay rate):</label>
              <input 
                type="range" 
                min="1000" 
                max="100000" 
                step="1000"
                value={base} 
                onChange={(e) => setBase(parseInt(e.target.value))}
                className="w-48"
              />
              <span>{base}</span>
            </div>
          </div>
          
          <div className="relative overflow-auto">
            <div className="flex flex-col items-center">
              <div className="grid" 
                style={{
                  gridTemplateColumns: `repeat(${seqLength}, minmax(20px, 1fr))`
                }}>
                {matrix.map((row, i) => (
                  row.map((value, j) => (
                    <div
                      key={`${i}-${j}`}
                      className="w-8 h-8 flex items-center justify-center text-xs border border-gray-200"
                      style={{
                        backgroundColor: getColor(value),
                        color: value > 0.5 ? 'white' : 'black'
                      }}
                    >
                      {value.toFixed(1)}
                    </div>
                  ))
                ))}
              </div>
            </div>
          </div>
          
          <div className="mt-4">
            <p className="text-sm text-gray-600">
              The base parameter controls how quickly similarity decays with distance. A larger base means slower decay (more attention to distant tokens), while a smaller base means faster decay (more focus on local context).
            </p>
          </div>
        </div>
      </CardContent>
    </Card>
  );
};

export default RoPEVisualization;
</antArtifact>

In RoPE, the frequency scaling is controlled by the base parameter in the formula:

$\theta_d = base^{-2d/D}$

The default value in most implementations is 10000, but this can be adjusted to change the attention span:

1. Lower base values (e.g., 1000) cause:
   - Faster similarity decay with distance
   - More focus on local context
   - Sharper distinction between nearby positions

2. Higher base values (e.g., 100000) cause:
   - Slower similarity decay
   - More attention to distant tokens
   - More gradual distinction between positions

This parameter is particularly important when:
- Fine-tuning models for specific tasks requiring different attention spans
- Adapting models to different sequence lengths
- Balancing local vs global attention patterns

Would you like me to explain more about how this parameter interacts with other aspects of the transformer architecture?


---

preceding: [[i want to visualize the relative distances as a covariance matrix heatmap visualization]]  


following: [[i think we need sliders for all the relevant variables here]]

See also: [[attention span]]