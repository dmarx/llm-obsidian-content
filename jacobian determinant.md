---
date: 1721162083.488448
tags:
- autogenerated
- source__oai
- conversation_id__4f78839e-971a-4476-b886-e0eef3bd4caf
- msg_9750209c-c310-46c0-82d1-3fdbc8fe09fc
- msg_b71fec22-ea84-4ab4-9c37-ca8646c5b5a7
- colorclass/information-theory
title: jacobian determinant
---

**USER**

Jacobian determinant


**ASSISTANT**

The Jacobian determinant plays a crucial role in [[normalizing flows]], including RealNVP, as it is used to transform densities through a series of invertible mappings. In the context of [[normalizing flows]], the Jacobian determinant is required for the change of variables formula, which allows us to compute the density of transformed variables.

## Jacobian Determinant in Normalizing Flows

### Change of Variables Formula

When transforming a random variable \( \mathbf{z} \) to \( \mathbf{x} \) using an invertible and differentiable function \( \mathbf{x} = f(\mathbf{z}) \), the density \( p_X(\mathbf{x}) \) of the transformed variable \( \mathbf{x} \) is given by the change of variables formula:

$$
p_X(\mathbf{x}) = p_Z(f^{-1}(\mathbf{x})) \left| \det \left( \frac{\partial f^{-1}(\mathbf{x})}{\partial \mathbf{x}} \right) \right|
$$

Alternatively, if we express the density in terms of \( \mathbf{z} \), it becomes:

$$
p_X(\mathbf{x}) = p_Z(\mathbf{z}) \left| \det \left( \frac{\partial f(\mathbf{z})}{\partial \mathbf{z}} \right) \right|^{-1}
$$

### RealNVP and Coupling Layers

RealNVP uses affine coupling layers to transform the input. The Jacobian determinant of these transformations is designed to be computationally efficient.

#### Affine Coupling Layer Transformation

Consider a coupling layer where the input \( \mathbf{z} \) is split into two parts, \( \mathbf{z}_A \) and \( \mathbf{z}_B \), and the transformation is defined as:

$$
\mathbf{z}_A' = \mathbf{z}_A \\
\mathbf{z}_B' = \mathbf{z}_B \odot \exp(s(\mathbf{z}_A)) + t(\mathbf{z}_A)
$$

Here:
- \( s(\mathbf{z}_A) \) is the scaling function.
- \( t(\mathbf{z}_A) \) is the translation function.
- \( \odot \) denotes element-wise multiplication.

#### Jacobian Matrix

The Jacobian matrix \( \mathbf{J} \) of the transformation \( f(\mathbf{z}) \) is a block matrix:

$$
\mathbf{J} = \begin{pmatrix}
\mathbf{I} & \mathbf{0} \\
\frac{\partial \mathbf{z}_B'}{\partial \mathbf{z}_A} & \frac{\partial \mathbf{z}_B'}{\partial \mathbf{z}_B}
\end{pmatrix}
$$

where:
- \( \mathbf{I} \) is the identity matrix.
- \( \mathbf{0} \) is a matrix of zeros.

Since \( \mathbf{z}_A' = \mathbf{z}_A \), the partial derivatives of \( \mathbf{z}_A' \) with respect to \( \mathbf{z}_A \) and \( \mathbf{z}_B \) are identity and zero matrices, respectively. The key part is the derivative of \( \mathbf{z}_B' \) with respect to \( \mathbf{z}_B \):

$$
\frac{\partial \mathbf{z}_B'}{\partial \mathbf{z}_B} = \text{diag}(\exp(s(\mathbf{z}_A)))
$$

This is a diagonal matrix because the transformation of \( \mathbf{z}_B \) is element-wise. Therefore, the Jacobian determinant simplifies to the product of the diagonal elements of this matrix.

#### Determinant Calculation

The determinant of the Jacobian matrix is:

$$
\det(\mathbf{J}) = \det\left( \frac{\partial \mathbf{z}_A'}{\partial \mathbf{z}_A} \right) \cdot \det\left( \frac{\partial \mathbf{z}_B'}{\partial \mathbf{z}_B} \right) = 1 \cdot \prod_{i} \exp(s(\mathbf{z}_A)_i) = \exp\left( \sum_{i} s(\mathbf{z}_A)_i \right)
$$

Thus, the log-determinant is simply:

$$
\log \left| \det(\mathbf{J}) \right| = \sum_{i} s(\mathbf{z}_A)_i
$$

This efficient computation of the Jacobian determinant is a key advantage of using coupling layers in [[normalizing flows]] like RealNVP.

## Example Calculation

Let's walk through an example calculation for a single coupling layer transformation. Suppose the input vector \( \mathbf{z} \) is 4-dimensional and split into two parts \( \mathbf{z}_A \) and \( \mathbf{z}_B \), each 2-dimensional. Assume the scaling function \( s(\mathbf{z}_A) \) outputs \((s_1, s_2)\).

1. **Input Split**:
   \[
   \mathbf{z} = (\mathbf{z}_A, \mathbf{z}_B) = ([z_{A1}, z_{A2}], [z_{B1}, z_{B2}])
   \]

2. **Transformation**:
   \[
   \mathbf{z}_A' = \mathbf{z}_A
   \]
   \[
   \mathbf{z}_B' = \mathbf{z}_B \odot \exp(s(\mathbf{z}_A)) + t(\mathbf{z}_A)
   \]

3. **Jacobian Matrix**:
   \[
   \mathbf{J} = \begin{pmatrix}
   1 & 0 & 0 & 0 \\
   0 & 1 & 0 & 0 \\
   0 & 0 & \exp(s_1) & 0 \\
   0 & 0 & 0 & \exp(s_2)
   \end{pmatrix}
   \]

4. **Jacobian Determinant**:
   \[
   \det(\mathbf{J}) = 1 \cdot 1 \cdot \exp(s_1) \cdot \exp(s_2) = \exp(s_1 + s_2)
   \]

5. **Log-Determinant**:
   \[
   \log \left| \det(\mathbf{J}) \right| = s_1 + s_2
   \]

In this way, RealNVP efficiently computes the Jacobian determinant, making it practical for high-dimensional transformations required in generative models and [[variational inference]].

## Conclusion

The Jacobian determinant is a critical component in [[normalizing flows]], enabling the transformation of probability densities through invertible mappings. In RealNVP, the design of affine coupling layers ensures that the Jacobian determinant can be computed efficiently, facilitating scalable and expressive modeling of complex distributions. This capability is leveraged in various applications, from density estimation to generative modeling and Bayesian inference.


---

preceding: [[realnvp]]  


following: [[geometric interpretation]]

See also: [[density estimation]]


See also: [[partial derivatives]]


See also: [[generative models]]


See also: [[change of variables]]