---
date: '2025-05-06T02:55:19.189715Z'
tags:
- autogenerated
- source__claude
- conversation_id__0511aaca-7e35-4b99-9727-ba35e690dc1d
- msg_495a6321-84ac-439e-8195-1b97e3e6d304
- msg_49508692-e35e-41d1-b35d-65c3dfb7e865
- colorclass/systems-theory
title: metadynamics
---

**USER**

metadynamics


**ASSISTANT**

# Metadynamics

Metadynamics is an [[[[enhanced sampling]] technique]] designed to efficiently explore [[free energy landscapes]] in [[molecular simulations]]. Developed by [[Alessandro Laio]] and [[Michele Parrinello]] in 2002, this method enables the study of [[rare events]] and the calculation of [[free energy surfaces]] along selected [[collective variables]] (CVs). Metadynamics belongs to the broader class of [[non-Boltzmann sampling methods]] and has become a cornerstone approach in [[computational biophysics]], [[materials science]], and [[chemical physics]].

## Core Principles

The fundamental idea of metadynamics is to encourage a system to explore previously visited regions of [[configurational space]] by progressively adding [[bias potentials]] in the form of small Gaussian "hills" along selected collective variables.

### Mathematical Formalism

In standard metadynamics, the [[biasing potential]] at time $t$ is defined as:

$$V_{\text{bias}}(\mathbf{s}, t) = \sum_{t' < t, t' = n\tau_G} w \exp\left(-\sum_{i=1}^{d} \frac{(s_i - s_i(t'))^2}{2\sigma_i^2}\right)$$

Where:
- $\mathbf{s} = (s_1, s_2, \ldots, s_d)$ represents a set of $d$ collective variables
- $w$ is the height of the Gaussian hills
- $\sigma_i$ is the width of the Gaussian in the dimension of the $i$-th collective variable
- $\tau_G$ is the frequency of hill deposition
- $s_i(t')$ is the value of the $i$-th collective variable at time $t'$

### Free Energy Estimation

In the long-time limit, the biasing potential converges to the negative of the free energy surface (FES) plus a constant:

$$\lim_{t \to \infty} V_{\text{bias}}(\mathbf{s}, t) = -F(\mathbf{s}) + C$$

Where:
- $F(\mathbf{s})$ is the free energy as a function of the collective variables
- $C$ is an arbitrary constant

### Convergence Properties

The error in the reconstructed free energy scales with the hill height $w$ and width $\sigma$:

$$\epsilon \propto \sqrt{w/\tau_G}$$

## Well-Tempered Metadynamics

[[Well-tempered metadynamics]] (WTMetaD) addresses convergence issues by dynamically reducing the height of the deposited Gaussian hills over time:

$$w(t) = w_0 \exp\left(-\frac{V_{\text{bias}}(\mathbf{s}(t), t)}{k_B \Delta T}\right)$$

Where:
- $w_0$ is the initial hill height
- $\Delta T$ is a parameter with units of temperature

The effective temperature of the system in the CV space becomes:

$$T + \Delta T = T \left(1 + \frac{\Delta T}{T}\right) = T \gamma$$

Where $\gamma$ is the [[bias factor]].

The biasing potential converges to:

$$\lim_{t \to \infty} V_{\text{bias}}(\mathbf{s}, t) = -\frac{\Delta T}{T + \Delta T}F(\mathbf{s}) + C = -\frac{\gamma - 1}{\gamma}F(\mathbf{s}) + C$$

## Metadynamics Variants

### Infrequent Metadynamics

[[Infrequent metadynamics]] (InMetaD) uses a large deposition stride $\tau_G$ to minimize bias-induced correlations:

$$\tau_G \gg \tau_c$$

Where $\tau_c$ is the [[correlation time]] of the CV.

### Parallel Bias Metadynamics

[[Parallel bias metadynamics]] (PBMetaD) deposits multiple independent bias potentials for each CV and combines them:

$$V_{\text{bias}}^{\text{PB}}(\mathbf{s}, t) = -\frac{1}{\beta}\ln\left(\sum_{i=1}^{d} \exp(-\beta V_{\text{bias}}^i(s_i, t))\right)$$

Where $V_{\text{bias}}^i(s_i, t)$ is the bias acting on the $i$-th CV.

### Transition-Tempered Metadynamics

[[Transition-tempered metadynamics]] (TTMetaD) modulates the bias deposition rate based on observed transitions between metastable states:

$$w(t) = w_0 \exp\left(-\kappa N_{\text{transitions}}(t)\right)$$

Where $N_{\text{transitions}}(t)$ counts the number of transitions and $\kappa$ controls the decay rate.

### Metadynamics with Adaptive Gaussians

This variant adapts the width of Gaussian hills based on local properties of the CV space:

$$\sigma_i(t) = \alpha \sqrt{\langle (s_i - \langle s_i \rangle)^2 \rangle}$$

Where $\alpha$ is a scaling factor.

## Collective Variable Selection

The choice of appropriate [[collective variables]] is crucial for effective metadynamics simulations. Ideal CVs should:

1. Clearly distinguish between relevant metastable states
2. Describe the slowest degrees of freedom in the system
3. Include all relevant degrees of freedom for the process of interest
4. Be few in number to avoid the [[curse of dimensionality]]

### Common Collective Variables

- [[Distances]]: $r_{ij} = |\mathbf{r}_i - \mathbf{r}_j|$
- [[Angles]]: $\theta_{ijk} = \cos^{-1}\left(\frac{(\mathbf{r}_j - \mathbf{r}_i) \cdot (\mathbf{r}_k - \mathbf{r}_j)}{|\mathbf{r}_j - \mathbf{r}_i||\mathbf{r}_k - \mathbf{r}_j|}\right)$
- [[Dihedrals]]: $\phi_{ijkl} = \tan^{-1}\left(\frac{(\mathbf{b}_i \times \mathbf{b}_j) \cdot \mathbf{b}_k}{|\mathbf{b}_j|(\mathbf{b}_i \cdot (\mathbf{b}_j \times \mathbf{b}_k))}\right)$
- [[Coordination numbers]]: $CN_i = \sum_{j \neq i} \frac{1 - (r_{ij}/r_0)^n}{1 - (r_{ij}/r_0)^m}$
- [[Radius of gyration]]: $R_g = \sqrt{\frac{1}{M}\sum_{i=1}^{N} m_i |\mathbf{r}_i - \mathbf{r}_{\text{COM}}|^2}$
- [[Root mean square deviation]]: $RMSD = \sqrt{\frac{1}{N}\sum_{i=1}^{N} |\mathbf{r}_i - \mathbf{r}_i^{\text{ref}}|^2}$
- [[Path collective variables]]: $s(R) = \frac{\sum_{i=1}^{N_P} i \exp(-\lambda d(R, R_i))}{\sum_{i=1}^{N_P} \exp(-\lambda d(R, R_i))}$
- [[Contact maps]]: $C_{ij} = \frac{1}{1 + \exp(b(r_{ij} - r_0))}$

### Machine Learning-Based CVs

Recent approaches use [[machine learning]] to identify optimal CVs:
- [[Autoencoders]] for [[dimensionality reduction]]
- [[Time-lagged independent component analysis]] (TICA)
- [[Variational approach to conformation dynamics]] (VAC)
- [[Deep learning]] methods for [[reaction coordinate discovery]]

## Reweighting in Metadynamics

To calculate [[ensemble averages]] of properties not directly related to the biased CVs, [[reweighting procedures]] are necessary.

### Basic Reweighting Formula

$$\langle A \rangle = \frac{\langle A e^{\beta V_{\text{bias}}(\mathbf{s}, t)} \rangle_{\text{biased}}}{\langle e^{\beta V_{\text{bias}}(\mathbf{s}, t)} \rangle_{\text{biased}}}$$

### Well-Tempered Reweighting

For well-tempered metadynamics:

$$\langle A \rangle = \frac{\langle A [e^{\beta V_{\text{bias}}(\mathbf{s}, t)}]^{\gamma} \rangle_{\text{biased}}}{\langle [e^{\beta V_{\text{bias}}(\mathbf{s}, t)}]^{\gamma} \rangle_{\text{biased}}}$$

Where $\gamma = \frac{T + \Delta T}{T}$ is the bias factor.

## Error Estimation

Several methods exist for estimating errors in metadynamics simulations:

### Block Analysis

The free energy surface is divided into time blocks, and the standard deviation is calculated:

$$\sigma_F(\mathbf{s}) = \sqrt{\frac{1}{N_b - 1}\sum_{i=1}^{N_b} (F_i(\mathbf{s}) - \langle F(\mathbf{s}) \rangle)^2}$$

### Integrated Autocorrelation Time

$$\tau_{\text{int}} = 1 + 2\sum_{k=1}^{\infty} \rho_k$$

Where $\rho_k$ is the [[autocorrelation function]] at lag $k$.

### Convergence Metrics

- [[Free energy difference]] between metastable states
- [[Hill height evolution]] in well-tempered metadynamics
- [[Recrossing events]] between states
- [[Diffusion behavior]] in CV space

## Integration with Other Methods

### Metadynamics and Replica Exchange

[[Replica exchange metadynamics]] combines the advantages of metadynamics and [[parallel tempering]]:

$$P_{\text{accept}}(i \leftrightarrow j) = \min\left[1, \exp(\beta_i (U_i + V_i^{\text{bias}}) + \beta_j (U_j + V_j^{\text{bias}}) - \beta_i (U_j + V_i^{\text{bias}}) - \beta_j (U_i + V_j^{\text{bias}}))\right]$$

### Metadynamics and Umbrella Sampling

[[Umbrella sampling metadynamics]] combines the static biasing of [[umbrella sampling]] with the adaptive bias of metadynamics:

$$V_{\text{total}}(\mathbf{s}) = V_{\text{umbrella}}(\mathbf{s}) + V_{\text{bias}}(\mathbf{s}, t)$$

Where:
$$V_{\text{umbrella}}(\mathbf{s}) = \frac{1}{2}k(\mathbf{s} - \mathbf{s}_0)^2$$

### On-the-Fly Probability Enhanced Sampling

[[On-the-fly probability [[enhanced sampling]]]] (OPES) uses on-the-fly estimates of the probability distribution:

$$V_{\text{bias}}(\mathbf{s}, t) = -\frac{1}{\beta}\ln\left(\frac{p(\mathbf{s})}{p_{\text{target}}(\mathbf{s})}\right)$$

## Multi-Dimensional Metadynamics

### Dimensional Scaling

The number of Gaussian hills required to fill a $d$-dimensional CV space scales as:

$$N_{\text{hills}} \propto \left(\frac{L}{\sigma}\right)^d$$

Where $L$ is the characteristic length of the CV space.

### Addressing the Curse of Dimensionality

Several approaches mitigate the [[curse of dimensionality]]:
- [[Bias exchange metadynamics]]
- [[Reconnaissance metadynamics]]
- [[Funnel metadynamics]]
- [[Path collective variables]]

## Implementation in Simulation Packages

Metadynamics is implemented in various [[molecular simulation]] software:
- [[PLUMED]]: A plugin for metadynamics and other [[enhanced sampling]] methods
- [[GROMACS]]: Through the PLUMED interface
- [[NAMD]]: Via the Collective Variables module
- [[CP2K]]: Built-in implementation
- [[LAMMPS]]: Through the PLUMED package
- [[Quantum ESPRESSO]]: For ab-initio metadynamics

## Applications

### Biomolecular Systems

- [[Protein folding]] and [[unfolding pathways]]
- [[Ligand binding]] and [[unbinding kinetics]]
- [[Conformational transitions]] in proteins and nucleic acids
- [[Membrane permeation]] by small molecules
- [[Enzymatic reactions]] and [[catalysis]]

### Materials Science

- [[Phase transitions]] in solids and liquids
- [[Nucleation phenomena]]
- [[Crystal growth]] mechanisms
- [[Diffusion pathways]] in solids
- [[Surface reconstructions]]

### Chemical Reactions

- [[Reaction mechanisms]] in solution and gas phase
- [[Transition state identification]]
- [[Solvation effects]] on reaction barriers
- [[Catalytic processes]] on surfaces

## Theoretical Connections

### Relationship to Other Enhanced Sampling Methods

Metadynamics is closely related to:
- [[Adaptive biasing force]] (ABF): $F_{\text{bias}}(\mathbf{s}) = -\nabla F(\mathbf{s})$
- [[Wang-Landau sampling]]: $V_{\text{bias}}(\mathbf{s}) = V_{\text{bias}}(\mathbf{s}) + \Delta V$
- [[Variationally [[enhanced sampling]]]]: $V_{\text{bias}}(\mathbf{s}) = -\frac{1}{\beta}\ln p_{\text{target}}(\mathbf{s})$

### Connection to Jarzynski Equality

Metadynamics can be understood in the context of the [[Jarzynski equality]]:

$$e^{-\beta \Delta F} = \langle e^{-\beta W} \rangle$$

Where $W$ is the work performed on the system.

## Advanced Concepts

### Local Elevation Method

The [[local elevation method]] is a precursor to metadynamics:

$$V_{\text{LE}}(\mathbf{s}, t) = \sum_{i=1}^{N_{\text{cells}}} w_i(t) \prod_{j=1}^{d} \phi_j(s_j - s_{i,j})$$

Where $\phi_j$ are basis functions and $w_i(t)$ are time-dependent weights.

### Variationally Enhanced Sampling

[[Variationally [[enhanced sampling]]]] (VES) optimizes the bias potential to match a target distribution:

$$V_{\text{bias}}(\mathbf{s}) = \text{argmin}_V D_{KL}[p_V(\mathbf{s}) || p_{\text{target}}(\mathbf{s})]$$

Where $D_{KL}$ is the [[Kullback-Leibler divergence]].

### Transition Path Sampling Integration

[[Infrequent metadynamics with transition path sampling]] combines metadynamics for [[enhanced sampling]] with [[transition path sampling]] for pathway analysis:

$$P[\mathbf{x}(t)] \propto e^{-\beta \int_0^T [H(\mathbf{x}(t), \mathbf{p}(t)) + V_{\text{bias}}(\mathbf{s}(\mathbf{x}(t)), t)] dt}$$

## Practical Considerations

### Parameter Selection

Guidelines for selecting metadynamics parameters:
- Hill height: $w \approx 0.5 - 1.0$ $k_B T$
- Hill width: $\sigma \approx 0.1 - 0.3$ of the CV range
- Deposition stride: $\tau_G \approx 100 - 1000$ MD steps
- Bias factor: $\gamma \approx 5 - 15$ for well-tempered metadynamics

### Computational Cost

The computational overhead of metadynamics scales as:

$$\text{Cost}_{\text{total}} = \text{Cost}_{\text{MD}} + \text{Cost}_{\text{CV}} + \text{Cost}_{\text{bias}}$$

Where:
- $\text{Cost}_{\text{MD}}$ is the base molecular dynamics cost
- $\text{Cost}_{\text{CV}}$ is the cost of calculating collective variables
- $\text{Cost}_{\text{bias}}$ is the cost of evaluating the bias potential

## Limitations and Challenges

1. **[[Collective variable selection]]**: Finding appropriate CVs remains a major challenge

2. **[[Dimensionality limitations]]**: Practical applications typically limited to 2-3 CVs

3. **[[Convergence assessment]]**: Determining when the free energy surface has converged

4. **[[Reweighting accuracy]]**: Increasing error with simulation time in reweighted properties

5. **[[Hysteresis effects]]**: Observed in systems with slow orthogonal degrees of freedom

## Future Directions

1. **[[Machine learning integration]]**: Automated discovery of optimal collective variables

2. **[[Enhanced reweighting methods]]**: Improved techniques for calculating unbiased ensemble averages

3. **[[Multiscale approaches]]**: Combining metadynamics with coarse-grained models

4. **[[Non-equilibrium applications]]**: Extending metadynamics to driven systems

5. **[[Quantum effects integration]]**: Incorporating nuclear quantum effects in metadynamics simulations


---

preceding: [[replica exchange]]  


following: [[slow degrees of freedom]]

See also: [[molecular dynamics]]


See also: [[free energy]]